#!/bin/bash
# 📋 Ubuntu 部署快速指南 - 一页纸总结

cat << 'EOF'

╔════════════════════════════════════════════════════════════════════╗
║                                                                    ║
║   🐧 Ubuntu 自动监控脚本 - 部署总结                               ║
║                                                                    ║
╚════════════════════════════════════════════════════════════════════╝

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📖 为您准备的 Ubuntu 工具和文档
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ check_ubuntu.sh
   → 自动检查 Ubuntu 环境是否满足要求
   → 运行: bash check_ubuntu.sh

✅ start_ubuntu.sh  
   → 交互式启动菜单，简化操作
   → 运行: bash start_ubuntu.sh

✅ UBUNTU_DEPLOYMENT.md
   → 详细的部署步骤和说明
   → 包含常见问题解决方案

✅ UBUNTU_CHECK_REPORT.md
   → Ubuntu 检查报告和快速参考

✅ WINDOWS_VS_UBUNTU.md
   → Windows 和 Ubuntu 对比指南

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 5分钟快速部署
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1️⃣  连接服务器并进入项目
    ssh root@your_server_ip
    cd /root/qqqrobot

2️⃣  创建虚拟环境
    python3 -m venv .venv
    source .venv/bin/activate

3️⃣  安装依赖
    pip install -r requirements.txt

4️⃣  配置 API 密钥
    cat > .env << 'ENVEOF'
    GATE_API_KEY=your_api_key
    GATE_API_SECRET=your_api_secret
    ENVEOF
    chmod 600 .env

5️⃣  给脚本执行权限
    chmod +x *.sh

6️⃣  运行检查
    bash check_ubuntu.sh

7️⃣  后台启动
    ./start_background.sh

8️⃣  查看日志
    tail -f auto_trade.log

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💻 常用命令速查
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔧 基本操作
  后台启动:        ./start_background.sh
  停止脚本:        ./stop.sh
  查看日志:        tail -f auto_trade.log
  检查环境:        bash check_ubuntu.sh

📋 查看状态
  查看进程:        ps aux | grep auto_stop_loss
  查看 screen:     screen -ls
  进入 screen:     screen -r trading
  查看最后日志:    tail -n 50 auto_trade.log

⚙️ 管理脚本
  编辑脚本:        nano auto_stop_loss.py
  激活虚拟环境:    source .venv/bin/activate
  安装依赖:        pip install -r requirements.txt
  清空日志:        > auto_trade.log

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔐 安全检查清单
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

☐ .env 文件权限已设为 600
  chmod 600 .env

☐ .env 文件不在 Git 中
  echo ".env" >> .gitignore

☐ 虚拟环境已激活
  source .venv/bin/activate

☐ 依赖包已安装
  pip list | grep gate-api

☐ 脚本有执行权限
  chmod +x *.sh

☐ 配置文件内容正确
  cat .env

☐ API 密钥有效
  bash check_ubuntu.sh

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
❓ 常见问题快速解答
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Q: 脚本不运行怎么办？
A: 运行 bash check_ubuntu.sh 诊断问题

Q: 如何修改监控的合约？
A: 编辑 auto_stop_loss.py，修改 CONTRACT = "XXX_USDT"

Q: 如何在 screen 中查看？
A: screen -r trading

Q: 如何退出 screen 但不停止程序？
A: 按 Ctrl+A 然后 D

Q: 脚本被意外停止了怎么办？
A: ./start_background.sh 重新启动

Q: 日志文件太大怎么办？
A: > auto_trade.log 清空日志

Q: 如何定期备份日志？
A: 见 UBUNTU_DEPLOYMENT.md 中的 Cron 配置

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📁 Ubuntu 专用文件列表
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✨ 新创建的文件:
   📄 check_ubuntu.sh              ← 运行此文件检查环境
   📄 start_ubuntu.sh              ← 交互式启动菜单
   📄 UBUNTU_DEPLOYMENT.md         ← 详细部署指南
   📄 UBUNTU_CHECK_REPORT.md       ← 检查报告
   📄 WINDOWS_VS_UBUNTU.md         ← 对比指南

原有的脚本:
   📄 start.sh                     ← 前台启动
   📄 start_background.sh          ← 后台启动
   📄 stop.sh                      ← 停止脚本
   📄 auto_stop_loss.py            ← 主脚本（核心）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 部署检查清单
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

部署前:
  ☐ 已连接到 Ubuntu 服务器
  ☐ 已进入项目目录

环境准备:
  ☐ Python3 已安装 (python3 --version)
  ☐ 虚拟环境已创建 (python3 -m venv .venv)
  ☐ 虚拟环境已激活 (source .venv/bin/activate)
  ☐ 依赖已安装 (pip install -r requirements.txt)

配置准备:
  ☐ .env 文件已创建
  ☐ API 密钥已添加
  ☐ 文件权限已设置 (chmod 600 .env)

脚本准备:
  ☐ 脚本有执行权限 (chmod +x *.sh)
  ☐ 运行检查通过 (bash check_ubuntu.sh)
  ☐ 前台测试通过 (python3 auto_stop_loss.py)

启动:
  ☐ 后台启动成功 (./start_background.sh)
  ☐ 日志正在生成 (tail -f auto_trade.log)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 建议的工作流程
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

首次部署:
  1. bash check_ubuntu.sh         检查环境
  2. python3 auto_stop_loss.py    前台测试
  3. Ctrl+C                        停止
  4. ./start_background.sh         后台启动
  5. tail -f auto_trade.log        查看运行

日常运行:
  • tail -f auto_trade.log         查看日志
  • ps aux | grep auto_stop_loss   检查进程
  • ./stop.sh                       需要停止时

定期维护:
  • 每周检查一次日志大小
  • 定期备份重要日志
  • 根据市场调整参数

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📞 更多帮助
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

遇到问题?

  1. 先运行检查: bash check_ubuntu.sh
  2. 查看日志:   tail -f auto_trade.log
  3. 查看指南:   cat UBUNTU_DEPLOYMENT.md
  4. 查看报告:   cat UBUNTU_CHECK_REPORT.md
  5. 对比说明:   cat WINDOWS_VS_UBUNTU.md

还有问题?
  • 查看脚本注释: head -50 auto_stop_loss.py
  • 查看完整指南: cat GUIDE.md
  • 查看快速开始: cat QUICKSTART_AUTO.md

════════════════════════════════════════════════════════════════════

                    ✅ Ubuntu 已完全准备好！

                      运行: bash start_ubuntu.sh
                      查看: tail -f auto_trade.log

════════════════════════════════════════════════════════════════════

EOF
