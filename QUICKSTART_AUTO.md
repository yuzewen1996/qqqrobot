# 🚀 快速开始 - 自动止损止盈监控

## ⚡ 5分钟快速部署

### 1️⃣ 本地测试（Windows）

```powershell
# 直接运行（前台测试）
python auto_stop_loss.py

# 或使用启动脚本
.\start.bat
```

按 `Ctrl+C` 停止

---

### 2️⃣ 服务器部署（Linux）

#### 方法A: 快速启动（推荐新手）

```bash
# 1. 上传文件到服务器
scp auto_stop_loss.py gatekey.env user@server:/root/qqqrobot/

# 2. 连接服务器
ssh user@server

# 3. 安装依赖
cd /root/qqqrobot
pip3 install gate-api python-dotenv

# 4. 使用 screen 后台运行
screen -S trading
python3 auto_stop_loss.py

# 5. 按 Ctrl+A 然后按 D 退出screen（程序继续运行）

# 6. 重新查看
screen -r trading
```

#### 方法B: 使用脚本（推荐）

```bash
# 1. 给脚本执行权限
chmod +x start.sh start_background.sh stop.sh

# 2. 后台启动
./start_background.sh

# 3. 查看日志
tail -f auto_trade.log

# 4. 停止程序
./stop.sh
```

---

## 📝 修改监控参数

编辑 `auto_stop_loss.py` 文件，找到配置区域：

```python
# ============ 配置区域 ============

CONTRACT = "ASTER_USDT"         # 合约名称
STOP_LOSS_PRICE = 0.912         # 止损价格
TAKE_PROFIT_PRICE = 0.9792      # 止盈价格
CHECK_INTERVAL = 60             # 检查间隔(秒)

# ============ 配置区域结束 ============
```

**当前配置说明**：
- 合约：ASTER_USDT
- 止损：$0.912 (相对入场价-5%)
- 止盈：$0.9792 (相对入场价+2%)
- 检查间隔：每60秒（1分钟）

---

## 📊 监控示例输出

```
====================================================================================================
自动交易监控已启动
====================================================================================================
监控参数:
  合约: ASTER_USDT
  止损价: $0.912000
  止盈价: $0.979200
  检查间隔: 60秒
====================================================================================================

----------------------------------------------------------------------------------------------------
[2025-12-10 17:37:12] 监控状态
  合约: ASTER_USDT [做多]
  持仓数量: 30.0
  入场价格: $0.956700
  当前价格: $0.959400
  盈亏: +0.28%
  止损价: $0.912000
  止盈价: $0.979200
  ✓ 未触发条件，继续监控...
----------------------------------------------------------------------------------------------------
```

---

## 🎯 触发条件说明

### 做多仓位（当前情况）
- **触发止损**：当前价格 ≤ $0.912 → 自动平仓
- **触发止盈**：当前价格 ≥ $0.9792 → 自动平仓

### 做空仓位
- **触发止损**：当前价格 ≥ 止损价 → 自动平仓
- **触发止盈**：当前价格 ≤ 止盈价 → 自动平仓

---

## 🔔 触发后的操作

当价格触发条件时，程序会：

1. **记录日志**
```
🚨 触发止损 (价格 $0.910000 <= 止损价 $0.912000)
```

2. **下市价单平仓**
```
✅ 平仓订单已提交
  订单ID: 12345678
  合约: ASTER_USDT
  数量: -30.0
  状态: finished
```

3. **停止监控**
```
✅ 自动平仓成功，停止监控
```

---

## 📁 重要文件

| 文件 | 说明 |
|------|------|
| `auto_stop_loss.py` | 主程序 |
| `auto_trade.log` | 运行日志（自动生成） |
| `gatekey.env` 或 `.env` | API密钥配置 |
| `start.sh` / `start.bat` | 前台启动脚本 |
| `start_background.sh` | 后台启动脚本 |
| `stop.sh` | 停止脚本 |

---

## 🔧 常用命令

### 查看日志
```bash
# 实时查看
tail -f auto_trade.log

# 查看最后100行
tail -n 100 auto_trade.log

# 搜索关键词
grep "触发" auto_trade.log
grep "平仓" auto_trade.log
```

### 检查运行状态
```bash
# 查找进程
ps aux | grep auto_stop_loss

# 查看CPU和内存占用
top -p <进程ID>
```

### 停止程序
```bash
# 方法1: 使用脚本
./stop.sh

# 方法2: 手动停止
kill <进程ID>

# 方法3: screen方式
screen -r trading
# 按 Ctrl+C
```

---

## ⚠️ 重要提醒

### 安全检查清单
- [ ] ✅ API密钥已配置
- [ ] ✅ 合约名称正确
- [ ] ✅ 止损止盈价格合理
- [ ] ✅ 本地测试通过
- [ ] ✅ 服务器网络稳定
- [ ] ✅ 日志文件可写入

### 风险提示
1. **网络中断**：服务器断网会导致监控失败
2. **价格跳空**：极端行情可能跳过止损价
3. **API限制**：频繁请求可能被限流（建议60秒间隔）
4. **滑点风险**：市价单可能有滑点

### 建议
- 先在小仓位测试
- 定期检查日志
- 保持服务器稳定运行
- 不要设置过于激进的止损价

---

## 🆘 故障排查

### 问题：找不到持仓
**解决**：
- 检查合约名称是否正确（区分大小写）
- 确认API密钥有合约权限
- 查看日志中的详细错误

### 问题：无法连接API
**解决**：
```bash
# 测试网络
ping api.gateio.ws

# 检查DNS
nslookup api.gateio.ws
```

### 问题：程序自动退出
**解决**：
- 查看 `auto_trade.log` 中的错误
- 检查Python版本（需要3.8+）
- 确认依赖已安装

---

## 📞 获取帮助

如果遇到问题：
1. 查看 `auto_trade.log` 日志文件
2. 检查API密钥权限
3. 确认网络连接正常
4. 验证持仓是否存在

---

## ✅ 验证部署成功

运行后看到以下输出说明成功：
```
✓ 配置文件加载成功
✓ 自动交易监控已启动
✓ 找到持仓信息
✓ 未触发条件，继续监控...
```

现在你的止损止盈监控已经在自动运行了！🎉
